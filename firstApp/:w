<!DOCTYPE html>
<html lang="en">
    <title>TODOリスト</title>
    <head>
        <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css">
        <script src="/bower_components/jquery/dist/jquery.min.js"></script>
        <script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

        <script type="text/javascript">
        <!--
        $(document).ready(function(){

            $("#modal_newbutton").click(function(){
                var taskName = $("#modal_taskname").val()
                var message = $("#modal_message").val()

                $.ajaxSetup({
                    headers: {
                        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                    }
                });
                $.ajax({
                    url: "/new",
                    type: "POST",
                    data: { "taskname":$("#modal_taskname").val(),
                            "message" :$("#modal_message").val()},
                    success:function(data){
                        alert("タスク登録が完了しました");
                    },
                    error:function(XMLHttpRequest, textStatus, errorThrown){
                        alert("Error:" + textStatus);
                    }
                });
            });

            $(".textarea").change(function(e){
                var objname = $(this).attr("id")
                objname = objname.replace(/textarea/g, 'btnupd')
                $("#"+objname).prop('disabled',false)
            });

            $(".checkbox").click(function(){
                $("#msg").text("checkbox touched")
            });

        });
        //-->
        </script>
        <title>TODOリスト</title>
    </head>

    <body>
        <meta name="csrf-token" content="{{ csrf_token() }}">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="container-header">
                    <button data-toggle="modal" data-target="#myModal" type="button" id="newbutton" class="btn btn-default navbar-btn">
                        新規
                    </button>
                </div>
            </div>
        </nav>

        <div class="container">
            <h4>TODOリスト一覧</h4>
            @foreach($users as $user)
            <form action="/updtask/{{$user->id}}" method="post">
                <div class="panel panel-success">
                    <div class="panel-heading">
                        @if($user->state === 1)
                        <div id="check_{{$user->id}}" class="checkbox"><label><input name="state" type="checkbox" value="checked" checked=checked>達成</label></div>
                        @else
                        <div id="check_{{$user->id}}" class="checkbox"><label><input name="state" type="checkbox" value="checked">達成</label></div>
                        @endif
                        <input value="更新" id="btnupd_{{$user->id}}" name="update" type="submit" class="btn btnupd btn-default navbar-btn">
                        <input value="削除" id="btndel_{{$user->id}}" name="delete" type="submit" class="btn btn-default navbar-btn">
                        {{ $user->title }}
                    </div>
                    <div class="panel-body">
                        <textarea name="message" id="textarea_{{$user->id}}" class="textarea form-control" rows="4">{{ $user->message }}</textarea>
                    </div>
<!--            
                    <div class="panel-footer">
                        登録日：{{ $user->done_date }}<br />
                        締切日：{{ $user->deadline_date }}<br />
                    </div>
--!>            
                </div>
                <input id="token2" type="hidden" name="_token" value="{{ csrf_token() }}">
            </form>
            @endforeach


 
            <!-- モーダルウィンドウの中身 -->
            <div class="modal fade" id="myModal">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h2 class="modal-title">新規作成</h2>
                                <hr />
                                <div class="form-group">
                                    <label>タスク名</label>
                                    <input id="modal_taskname" type="text" name="title" class="form-control">
                                </div>
                            </div>
                            <div class="modal-body">
                            <div class="form-group">
                            <label>本文</label>
                                <textarea id="modal_message" rows=8 cols=40  class="form-control"></textarea>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button id="modal_newbutton" type="button" class="btn btn-default  navbar-btn">新規作成</button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal">閉じる</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </body>
</html>

